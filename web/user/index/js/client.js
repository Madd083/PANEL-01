function fn_alert(e,a){$(".alert").attr("class","alert "+e),$(".alert").html(a)}function refill(e){$("#refill-btn").button("loading"),$.post("/ajax-handler.php",{email:e,svc:"refill-traffic"},function(e){res=JSON.parse(e),200==res.code?location.reload():(alert(res.msg),$("#refill-btn").button("reset"))})}function fn_detect_os(){return result=null,/NT 5./i.test(navigator.userAgent)?result=/wow64|win64|ia64|x64/i.test(navigator.userAgent)?"xp-64":"xp-32":/NT 6.|NT 7.|NT 8.|NT 9.|NT 10./i.test(navigator.userAgent)?result=/wow64|win64|ia64|x64/i.test(navigator.userAgent)?"vista-64":"vista-32":/iPhone|iPad|iPod/i.test(navigator.userAgent)?result="ios":/Android/i.test(navigator.userAgent)?result="android":/Macintosh/i.test(navigator.userAgent)&&(result="osx"),result}function download_sw(e){window.open("http://flipwalls.oss-cn-shenzhen.aliyuncs.com/openvpn.clients/"+e,"_self")}function download_profile(e){"ios"==fn_detect_os()?window.open("http://flipwalls.oss-cn-shenzhen.aliyuncs.com/openvpn.profile/"+e+".mobileconfig","_self"):window.open("http://flipwalls.oss-cn-shenzhen.aliyuncs.com/openvpn.profile/"+e+".ovpn","_self")}function purchase(e,a,t,n){var s="",r=$(e).html().match(/[¥|$| ][,0-9\.]+/g),o=r[r.length-1];switch(t){case"alipay":s="确认 支付宝 支付 "+o+" (RMB)?";break;case"paypal":s="确认 PayPal 支付 "+o+" (HKD)?";break;case"vcoin":s="确认支付 "+o+"枚 金币?"}confirm(s)&&($(".pur-btn").prop("disabled",!0),$(e).removeProp("disabled"),$(e).button("loading"),$.ajax({type:"POST",async:!1,url:"/ajax-handler.php",data:{svc:"create-order",prod_id:a,gw:t,coupon:n},success:function(a){res=JSON.parse(a),200==res.code?"alipay"==res.gw?($("#alipay-order-id").val(res.order_id),$("#alipay-subject").val(res.subject),$("#alipay-amount").val(res.amount),$("#form-alipay").submit()):"paypal"==res.gw?($("#paypal-custom").val(res.order_id),$("#paypal-item-name").val(res.subject),$("#paypal-item-amount").val(res.amount),$("#form-paypal").submit()):(res.gw="vcoin")&&window.open("thanks.php","_self"):alert(res.msg),$(".pur-btn").removeProp("disabled"),$(e).button("reset")}}))}function apply_coupon(){window.open("?coupon="+$("#coupon").val(),"_self")}function gen_aff_qrcode(e){if($("#qrcode").html("暂无二维码"),$("#link-tip").empty(),$("#"+e).length>0){$("#qrcode").empty(),$("#"+e).select(),new QRCode("qrcode",{text:$("#"+e).val(),width:$("#qrcode").width(),height:$("#qrcode").width()});var a=$("#qrcode > canvas")[0].toDataURL(),t='<a class="btn btn-default" href="'+a+'" download="flipwalls.png" type="image/png">下载二维码</a><br>';$("#link-tip").html(t+$("#"+e).val())}$("#qrcode > img").attr("data-no-retina","")}function apply_refcode(){$("#btn-apply-code").prop("disabled","disabled"),fn_alert("alert-info","申请中，请稍候..."),$.post("/ajax-handler.php",{svc:"create-referral-link"},function(e){res=JSON.parse(e),200==res.code?(fn_alert("alert-success","申请成功，网页刷新中..."),location.reload()):(fn_alert("alert-danger",res.msg),$("#btn-apply-code").removeClass("disabled"))})}function change_password(){$.validator.setDefaults({errorPlacement:function(e,a){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")}});$("#form").validate({rules:{pass1:{equalTo:"#pass2",minlength:2},pass2:{equalTo:"#pass1",minlength:2}},submitHandler:function(e){$("#btn-submit").button("loading"),$.post("/ajax-handler.php",{svc:"update-password",opass:$("#opass").val(),npass:$("#pass1").val()},function(e){res=JSON.parse(e),200==res.code?(fn_alert("alert-success","已成功更新密码。"),$("input").val(""),$("input:first").focus()):fn_alert("alert-danger",res.msg),$("#btn-submit").button("reset")})}})}function exchange(){$("#vcoin-qty").focus(),$.validator.setDefaults({errorPlacement:function(e,a){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")}}),jQuery.validator.addMethod("num_of_vcoin",function(e,a){return this.optional(a)||/^[0-9]*[05]000/.test(e)});$("#appform").validate({rules:{vcoin_qty:{required:!0,num_of_vcoin:!0}},submitHandler:function(e,a){$("#submit-btn").button("loading"),$.post("/ajax-handler.php",{svc:"request-redeem",email:$("#email").val(),alipay_id:$("#alipay-id").val(),alipay_name:$("#alipay-name").val(),vcoin_qty:$("#vcoin-qty").val()},function(e){res=JSON.parse(e),200==res.code?(fn_alert("alert-success","申请已提交。2个工作日内，我们会通过电邮告知申请结果。申请编号 "+res.number),$("input").attr("disabled","disabled")):(fn_alert("alert-danger",res.msg),$("#submit-btn").button("reset"))}),a.preventDefault()}})}